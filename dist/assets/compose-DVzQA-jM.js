import{_ as T,r as o,u as $,b as M,d as N,w as U,e as q,o as u,c as d,a as e,f as k,v as j,t as r,g as D,F as E,h as P,i as F,j as J,p as O,k as R,l as z}from"./index-BiaFJ7TC.js";const v=f=>(O("data-v-b0ba08e6"),f=f(),R(),f),A={key:0},G=v(()=>e("label",{for:"subject"},"Subject:",-1)),H=v(()=>e("label",{for:"body"},"Body:",-1)),K=v(()=>e("summary",{role:"button"},"View the message Body (Rendered)",-1)),Q=v(()=>e("label",{for:"list"},"Select List:",-1)),W=v(()=>e("option",{value:"",disabled:""},"---Please select a list---",-1)),X=["value"],Y=v(()=>e("button",{type:"submit"},"Send",-1)),Z={role:"alert"},ee={class:"progress-bar-container"},le={key:0},te={role:"button"},ae={style:{"list-style-type":"none"}},se={key:1},oe=v(()=>e("p",null,"Loading Configuration...",-1)),ne=[oe],re={__name:"compose",setup(f){const i=o({loaded:!1,lists:[]}),y=o({loaded:!1}),a=o(""),c=o(""),n=o(""),S=o(""),b=o(0),p=o(0),_=o({loaded:!1,logs:[]}),I=o(null),{socket:h,connectionManager:L,reconnect:de}=$(),g=s=>{S.value=s,setTimeout(()=>{S.value=""},4e3)};M(()=>{const s=JSON.parse(localStorage.getItem("maillist"))||{lists:[]},l=JSON.parse(localStorage.getItem("mailsettings"))||{loaded:!1},t=localStorage.getItem("subject")||"",m=localStorage.getItem("body")||"",x=localStorage.getItem("selectedList")||"";i.value={loaded:!0,...s},y.value={loaded:!0,...l},c.value=t,n.value=m,a.value=x,h.on("mailsent",w=>{b.value+=1,g(`${b.value} emails Sent`),B()}),h.on("mailerror",w=>{p.value+=1,_.value.loaded=!0,_.value.logs.push(w),g(`${p.value} Errors found. Current error: ${w.error}. Please expand the Error details menu to view all errors`),B()})}),N(()=>{h.off("mailsent"),h.off("mailerror")}),U([c,n,a],()=>{localStorage.setItem("subject",c.value),localStorage.setItem("body",n.value),localStorage.setItem("selectedList",a.value)});const V=()=>{if(!L.value.connected)g('Sorry. we cant find a sutable layer to connect with our underlying mail transportation system. Please reload the page and click the "Send" Button');else if(!y.value.loaded)g("Sorry, you haven't provided any SMTP information to send the emails. Please go to SMTP settings and provide your SMTP information and try again.");else if(!a.value||!c.value.trim()||!n.value.trim())g("Please select a list, and fill in both the subject and body.");else{g("Sending emails...");const s=i.value.lists[a.value].items.map(l=>({email:l.email,name:l.name,body:n.value.replace(/\[name\]/g,l.name).replace(/\[email\]/g,l.email)}));b.value=0,p.value=0,_.value.loaded=!1,_.value.logs=[],h.emit("sendmails",y.value,s,c.value)}},B=()=>{if(I.value){const s=i.value.lists[a.value].items.length,l=b.value+p.value;I.value.style.width=`${l/s*100}%`}},C=q(()=>{if(a.value&&i.value.lists[a.value].items.length>0){const s=i.value.lists[a.value].items[0];return n.value.replace(/\[name\]/g,s.name).replace(/\[email\]/g,s.email)}return n.value});return(s,l)=>i.value.loaded?(u(),d("div",A,[e("form",{onSubmit:F(V,["prevent"])},[e("div",null,[G,k(e("input",{id:"subject","onUpdate:modelValue":l[0]||(l[0]=t=>c.value=t),placeholder:"Subject",required:""},null,512),[[j,c.value]])]),e("div",null,[H,k(e("textarea",{id:"body","onUpdate:modelValue":l[1]||(l[1]=t=>n.value=t),placeholder:"Email body",required:""},null,512),[[j,n.value]]),e("details",null,[K,e("div",null,r(C.value),1)])]),e("div",null,[Q,k(e("select",{id:"list","onUpdate:modelValue":l[2]||(l[2]=t=>a.value=t),required:""},[W,(u(!0),d(E,null,P(i.value.lists,(t,m)=>(u(),d("option",{key:m,value:m},r(t.name),9,X))),128))],512),[[D,a.value]])]),Y],32),e("div",null,[e("p",Z,r(S.value),1),e("div",ee,[e("div",{class:"progress-bar",ref_key:"progressBar",ref:I},null,512)]),e("p",null,r(b.value)+" emails sent, "+r(p.value)+" errors",1)]),_.value.loaded?(u(),d("details",le,[e("summary",te,"View "+r(p.value)+" Error Details",1),e("ul",ae,[(u(!0),d(E,null,P(_.value.logs,(t,m)=>(u(),d("li",{key:m},[e("p",null,"Index: "+r(m),1),e("p",null,"Email: "+r(t.email),1),e("p",null,"Error: "+r(t.error),1)]))),128))])])):J("",!0)])):(u(),d("div",se,ne))}},ie=T(re,[["__scopeId","data-v-b0ba08e6"]]),ue=e("h1",null,"Compose new email",-1),me={__name:"compose",setup(f){return M(()=>{document.title="Compose new Email | Transport"}),(i,y)=>(u(),d(E,null,[ue,z(ie)],64))}};export{me as default};
